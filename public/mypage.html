<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë„ìœ¤ì´ì˜ í”¼ìê°€ê²Œ | ë§ˆì´í˜ì´ì§€</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap");

    :root {
      --background: #fff9f4;
      --card: #fffdf9;
      --primary: #f97316;
      --primary-dark: #ea580c;
      --accent: #fcd34d;
      --text: #1f140f;
      --muted: #7a5c4b;
      --border: #f2d2ba;
      --shadow: 0 20px 45px rgba(249, 115, 22, 0.12);
      --radius: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, rgba(250, 215, 182, 0.4), transparent 55%), var(--background);
      color: var(--text);
      padding: 40px 16px 80px;
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
    }

    .masthead {
      background: linear-gradient(135deg, #ffe1c6, #ffd1b1);
      border-radius: 28px;
      padding: 32px;
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .masthead h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
    }

    .masthead p {
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 16px;
    }

    .masthead .cta {
      margin-left: auto;
      display: flex;
      gap: 12px;
    }

    .masthead button,
    .masthead a {
      border: none;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 600;
      background: var(--text);
      color: #fff;
      cursor: pointer;
      text-decoration: none;
    }

    .content {
      margin-top: 32px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
      gap: 24px;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(249, 115, 22, 0.08);
    }

    .card h2 {
      margin: 0 0 16px;
      font-size: 20px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="email"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 15px;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
    }

    .form-grid {
      display: grid;
      gap: 16px;
      margin-top: 12px;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 12px 18px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    button:active {
      transform: scale(0.98);
    }

    #updateBtn {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 8px 20px rgba(249, 115, 22, 0.2);
    }

    #logoutBtn {
      background: #fef3f2;
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.2);
    }

    .summary-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-radius: 16px;
      background: #fff4e6;
      margin-bottom: 16px;
    }

    .summary-card strong {
      font-size: 22px;
    }

    #paymentsArea {
      border-radius: 16px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.04);
      padding: 12px;
      max-height: 420px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th {
      text-align: left;
      padding: 12px;
      font-weight: 600;
      color: var(--muted);
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      background: #fff8f3;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
    }

    tr:last-child td {
      border-bottom: none;
    }

    #message {
      margin-top: 10px;
      font-size: 14px;
      min-height: 20px;
      font-weight: 600;
    }

    @media (max-width: 900px) {
      .content {
        grid-template-columns: 1fr;
      }

      .masthead {
        flex-direction: column;
        align-items: flex-start;
      }

      .masthead .cta {
        margin-left: 0;
      }
    }
  </style>
</head>

<body>
  <div class="page">
    <header class="masthead">
      <div>
        <p style="margin:0;font-size:14px;font-weight:600;color:#b45309;">DOYUN'S PIZZA HOUSE</p>
        <h1>ë§ˆì´í˜ì´ì§€</h1>
        <p>ë‚´ ì •ë³´ì™€ ê²°ì œë‚´ì—­ì„ í•œëˆˆì— í™•ì¸í•˜ê³ , ë„ìœ¤ì´ì˜ í”¼ìê°€ê²Œ ë©¤ë²„ì‹­ í˜œíƒì„ ë°›ì•„ë³´ì„¸ìš”.</p>
      </div>
      <div class="cta">
        <a href="/">ë©”ì¸ìœ¼ë¡œ ì´ë™</a>
      </div>
    </header>

    <main class="content">
      <section class="card">
        <h2>ğŸ• íšŒì›ì •ë³´ ê´€ë¦¬</h2>
        <div class="form-grid">
          <div>
            <label for="email">ì´ë©”ì¼</label>
            <input id="email" type="email" readonly />
          </div>

          <div>
            <label for="fullName">ì´ë¦„</label>
            <input id="fullName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
          </div>

          <div>
            <label for="phone">ì „í™”ë²ˆí˜¸</label>
            <input id="phone" type="text" placeholder="010-0000-0000" />
          </div>
        </div>
        <div class="button-row">
          <button id="updateBtn">ì •ë³´ ì €ì¥</button>
          <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        <div id="message" role="status" aria-live="polite"></div>
      </section>

      <section class="card">
        <h2>ğŸ§¾ ê²°ì œ ë‚´ì—­</h2>
        <div class="summary-card">
          <div>
            <p style="margin:0;font-size:13px;color:var(--muted);">ìµœê·¼ ì£¼ë¬¸ ë‚´ì—­</p>
            <strong>ë‚˜ì˜ ì£¼ë¬¸ íˆìŠ¤í† ë¦¬</strong>
          </div>
          <span style="color:var(--primary);font-weight:700;">â™¥</span>
        </div>
        <div id="paymentsArea">ë¡œë”©ì¤‘...</div>
      </section>
    </main>
  </div>

	<script type="module">
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

		const SUPABASE_URL = 'https://vokdtihuzdbcgylftrar.supabase.co'
		const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZva2R0aWh1emRiY2d5bGZ0cmFyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMDQzMjUsImV4cCI6MjA4MzU4MDMyNX0.Vm9aw8AlUvV49AU1iMXyi1jPMGH8EgDS-9V8KEg5BTQ'

		const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

		const emailInput = document.getElementById('email')
		const fullNameInput = document.getElementById('fullName')
		const phoneInput = document.getElementById('phone')
		const updateBtn = document.getElementById('updateBtn')
		const logoutBtn = document.getElementById('logoutBtn')
		const messageEl = document.getElementById('message')
		const paymentsArea = document.getElementById('paymentsArea')

		function showMessage(text, isError = false) {
			messageEl.style.color = isError ? '#e11d48' : '#065f46'
			messageEl.textContent = text
		}

		async function loadUser() {
			const { data: { user }, error } = await supabase.auth.getUser()
			if (error || !user) {
				// ë¡œê·¸ì¸ í•„ìš”
				location.href = '/login.html'
				return
			}
			emailInput.value = user.email || ''
			fullNameInput.value = (user.user_metadata && user.user_metadata.full_name) || ''
			phoneInput.value = (user.user_metadata && user.user_metadata.phone) || ''
			loadPayments(user.id)
		}

		async function updateProfile() {
			showMessage('ì €ì¥ ì¤‘...', false)
			const updates = {
				full_name: fullNameInput.value.trim(),
				phone: phoneInput.value.trim()
			}
			const { data, error } = await supabase.auth.updateUser({ data: updates })
			if (error) {
				showMessage(error.message || 'ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', true)
				return
			}
			showMessage('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', false)
			console.log('updateUser', data)
		}

		async function handleLogout() {
			await supabase.auth.signOut()
			location.href = '/login.html'
		}

		async function loadPayments(userId) {
			paymentsArea.textContent = 'ê²°ì œë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'
			try {
				const { data, error } = await supabase
					.from('payments')
					.select('id, amount, status, created_at')
					.eq('user_id', userId)
					.order('created_at', { ascending: false })
				if (error) {
					console.error('payments error', error)
					paymentsArea.textContent = 'ê²°ì œë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'
					return
				}
				if (!data || data.length === 0) {
					paymentsArea.textContent = 'ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.'
					return
				}
				const table = document.createElement('table')
				const thead = document.createElement('thead')
				thead.innerHTML = '<tr><th>ì£¼ë¬¸ID</th><th>ê¸ˆì•¡</th><th>ìƒíƒœ</th><th>ë‚ ì§œ</th></tr>'
				table.appendChild(thead)
				const tbody = document.createElement('tbody')
				for (const p of data) {
					const tr = document.createElement('tr')
					const date = new Date(p.created_at).toLocaleString()
					tr.innerHTML = `<td>${p.id}</td><td>${p.amount}</td><td>${p.status || ''}</td><td>${date}</td>`
					tbody.appendChild(tr)
				}
				table.appendChild(tbody)
				paymentsArea.innerHTML = ''
				paymentsArea.appendChild(table)
				// ë§ˆì´í˜ì´ì§€ ê´€ë ¨ TODO ì™„ë£Œ í‘œì‹œëŠ” í˜¸ì¶œ ì¸¡ì—ì„œ ì²˜ë¦¬
			} catch (err) {
				console.error(err)
				paymentsArea.textContent = 'ê²°ì œë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
			}
		}

		updateBtn.addEventListener('click', (e) => { e.preventDefault(); updateProfile() })
		logoutBtn.addEventListener('click', (e) => { e.preventDefault(); handleLogout() })

		// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
		loadUser()
	</script>
</body>
</html>
